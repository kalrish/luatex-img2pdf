include_rules

: |> tup varsed img2pdf.ini.lua.in %o |> img2pdf.ini.lua
: img2pdf.ini.lua |> !texluac |> | <required_to_use_luatex_img2pdf>

: |> @(LUATEX) --ini --interaction=nonstopmode --halt-on-error --jobname=img2pdf --output-format=pdf -- img2pdf.ini.tex |> img2pdf.log img2pdf.fmt <required_to_use_luatex_img2pdf>

ifeq (@(TUP_PLATFORM),win32)
	: |> tup varsed luatex-img2pdf.bat.in %o |> luatex-img2pdf.bat <required_to_use_luatex_img2pdf>
else
	: |> tup varsed luatex-img2pdf.bash.in %o |> luatex-img2pdf.bash <required_to_use_luatex_img2pdf>
endif

: |> tup varsed install.bash.in %o |> install.bash

ifeq (@(TEST),y)
	ifeq (@(TUP_PLATFORM),win32)
		TEST_COMMAND_START = luatex-img2pdf.bat
	else
		TEST_COMMAND_START = bash --noprofile --norc -- luatex-img2pdf.bash
	endif
	
	include Tupfile.lua
	
	: <required_to_use_luatex_img2pdf> |> $(TEST_COMMAND_START) --extra-lua-file=extra.lua -- small.png using_extra.pdf |> using_extra.log using_extra.pdf
	
	ifeq (@(TEST_HUGE),y)
		: <required_to_use_luatex_img2pdf> huge-0-0.pdf |> $(TEST_COMMAND_START) --pdf-compression-level=9 -- huge-0-0.pdf compressing_uncompressed-huge.pdf |> compressing_uncompressed-huge.log compressing_uncompressed-huge.pdf
	endif
endif